<?xml version="1.0" encoding="UTF-8"?>

<launch>

  <!-- input parameters: -->
  <arg name="throttle"          default="False" />
  <arg name="throttle_rate"     default="10.0" />
  <arg name="vrpn_server_ip"    default="192.168.0.107" />
  <arg name="group_name"        default="" />
  <arg name="object_name"       default="rigid_body" />
  <arg name="node_name"         default="vrpn_client_$(arg object_name)" />
  <arg name="verbose"           default="False" />

  <!-- the vrpn_client -->
  <node name="$(arg node_name)" type="ros_vrpn_client" pkg="ros_vrpn_client" output="screen">
    <param name="vrpn_server_ip" value="$(arg vrpn_server_ip)" />
    <param name="vrpn_coordinate_system" value="vicon" />
    <param name="timestamping_system" value="ros" />
    <param name="object_name" value="$(arg object_name)" />
    <param name="verbose" value="$(arg verbose)" />
    <param name="translational_estimator/kp" value="0.5" />
    <param name="translational_estimator/kv" value="0.5" />
    <param name="rotational_estimator/orientation_estimate_initial_covariance" value="100.0" />
    <param name="rotational_estimator/rate_estimate_initial_covariance" value="100.0" />
    <param name="rotational_estimator/orientation_process_covariance" value="0.000002" />
    <param name="rotational_estimator/rate_process_covariance" value="10.0" />
    <param name="rotational_estimator/orientation_measurementCovriance" value="0.001" />
    <param name="rotational_estimator/outlier_rejection_method" value="mahalanobis_distance" />
    <param name="rotational_estimator/outlier_rejection_mahalanobis_threshold" value="4.0" />
    <param name="rotational_estimator/outlier_rejection_subsequent_threshold_degrees" value="30.0" />
    <param name="rotational_estimator/outlier_rejection_subsequent_maximum_count" value="50.0" />
    <param name="rotational_estimator/output_minimal_quaternions" value="False" />
    <param name="rotational_estimator/output_minimal_quaternions" value="False" />
  </node>

  <!-- throttle the vrpn poses if needed --> 
  <!--<node name="mocap_throttle_$(arg object_name)" type="throttle" pkg="topic_tools" args="messages /$(arg group_name)/$(arg node_name)/raw_pose $(arg throttle_rate) /$(arg group_name)/$(arg node_name)/raw_pose_throttled" if="$(arg throttle)"/> -->

  <node name="mocap_throttle_$(arg object_name)" type="throttle" pkg="topic_tools" args="messages $(arg node_name)/raw_pose $(arg throttle_rate) $(arg node_name)/raw_pose_throttled" if="$(arg throttle)"/>
</launch>
